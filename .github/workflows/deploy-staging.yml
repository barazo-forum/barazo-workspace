name: Deploy to Staging

on:
  push:
    branches:
      - main
    paths:
      - "pnpm-lock.yaml"
      - "pnpm-workspace.yaml"
      - "package.json"

permissions: {}

jobs:
  trigger-deploy:
    name: Trigger Staging Deploy
    runs-on: ubuntu-latest
    steps:
      - name: Dispatch to barazo-deploy
        uses: peter-evans/repository-dispatch@ff45666b9427631e3450c54a1bcbee4d9ff4d7c0 # v3
        with:
          token: ${{ secrets.DEPLOY_PAT }}
          repository: barazo-forum/barazo-deploy
          event-type: deploy-staging
          client-payload: |
            {
              "trigger_repo": "barazo-workspace",
              "api_ref": "main",
              "web_ref": "main"
            }
